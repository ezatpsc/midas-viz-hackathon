<!DOCTYPE html>
<!--
    Drug Poisoning Mortality in US Visualization
    
    This is meant to be a standards-compliant HTML5 document
    Without the use of custom tags
        Due to concerns about backwards-compatibility
    And without default mimetype declarations
        Due to concerns about readability and concision
-->
<html>
<head>
    <meta charset="UTF-8">
    <title>Drug-related Poisonings</title>
    <link rel="icon" href="./images/favicon.png">
    <link rel="stylesheet" href="./css/main.css">
    
    <!-- Allow Pinch Zooming -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- Leaflet -->
    <link rel="stylesheet" href="./Leaflet/leaflet.css">
    <script src="./Leaflet/leaflet.js"></script>
    
    <!-- insert plugins here -->
    
    <!-- Zoom slider -->
    <link rel="stylesheet" href="./Leaflet.zoomslider/L.Control.Zoomslider.css">
    <script src="./Leaflet.zoomslider/L.Control.Zoomslider.js"></script>
    
    <!-- Leaflet.hash -->
    <script src="./Leaflet.hash/leaflet-hash.js"></script>
    
</head>
<body>
    <div id="map"></div>
    
    <script src="data/us_counties_20m.js"></script> <!-- US County Borders -->
    <script src="data/us_states_20m.js"></script> <!-- US State Borders -->
    <script src="data/county-pretty-print.js"></script> <!-- County Data -->
    
    <script>
    /* BEGIN Tile Layer Definitions */
    if (! L.Browser.retina) {
        var OpenStreetMap_Mapnik_Insecure = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            noWrap: true,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            // https: also suppported.
        });
    } else {
        var OpenStreetMap_Mapnik_Insecure = L.tileLayer('http://gpstrails.info/ex/tileserver/mbtiles-server-test4.php?db=osm.mbtiles&z={z}&x={x}&y={y}', {
            maxZoom: 16,
            noWrap: true,
            detectRetina: true,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });
    }

    var CartoDB_DarkMatter_Insecure = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}'+(L.Browser.retina? '@2x': '')+'.png', {
        maxZoom: 19,
        noWrap: true,
        subdomains: 'abcd',
        detectRetina: true,
        //errorTileUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAJOgAACToAYJjBRwAAAAMSURBVBhXY2BgYAAAAAQAAVzN/2kAAAAASUVORK5CYII=',
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'
    });
    /*   END Tile Layer Definitions */
    
    // map defaults
    var default_basemap = [OpenStreetMap_Mapnik_Insecure];
    var BaltimoreMD = [39.2861, -76.6296];
    var USA_view = [38.58,-97.91];
    var default_location = USA_view;
    var default_zoom = 4;
    
    // initialize the map
    var map = L.map('map', {
        layers: default_basemap,
        center: default_location,
        zoomControl: false,
        zoom: default_zoom
    });
    
    // add a zoom slider
    var map_zoom = map.addControl(new L.Control.Zoomslider());

    // add a scale
    var map_scale = L.control.scale({position: 'bottomleft'}).addTo(map);


    /* BEGIN RANDOM COLOR FUNCTION */
    function getRandomColor() {
      // creating a random number between 0 and 255
      var r = Math.floor(Math.random() * 256);
      var g = Math.floor(Math.random() * 256);
      var b = Math.floor(Math.random() * 256);

      // going from decimal to hex
      var hexR = r.toString(16);
      var hexG = g.toString(16);
      var hexB = b.toString(16);

      // making sure single character values are prepended with a "0"
      if (hexR.length == 1) {
        hexR = "0" + hexR;
      }

      if (hexG.length == 1) {
        hexG = "0" + hexG;
      }

      if (hexB.length == 1) {
        hexB = "0" + hexB;
      }

      // creating the hex value by concatenatening the string values
      var hexColor = "#" + hexR + hexG + hexB;
      
      return hexColor.toUpperCase();
    }
    /*   END RANDOM COLOR FUNCTION */
    
    
    function blank_style(feature) {
        return {
            weight: 0,
            fill: false
        };
    }

    function example_style(feature) {
        return {
            fillColor: getRandomColor(),
            weight: 0,
            opacity: 1,
            color: 'silver',
            dashArray: '3',
            fillOpacity: 0.92
        };
    }
    
    
    function state_outline_style(feature) {
        return {
            fill: false,
            color: 'white',
            dashArray: '5, 5',
            weight: 2
        };
    }
    
    function getRandomYear() {
        return Math.floor(Math.random() * (2014 - 2002 + 1)) + 2002;
    }
    
    function onEachCounty(feature, layer) {
        /*
        feature.properties.time = getRandomYear();
        layer.bindPopup(feature.properties.NAME + "\n" + feature.properties.time);
        */
    }

    function onEachAdditionalCounty(feature, layer) {
        /*layer.bindPopup(feature.properties.NAME + "\n" + feature.properties.time);*/
        //feature.properties.time = getRandomYear();
        feature.properties.time = i
        //feature.properties.deathrate = county_data['county-data'][feature.properties.GEOID][i]['deathrate'];
        layer.addTo(map_us_counties);
        layer.bindPopup(feature.properties.NAME + "\n" + feature.properties.time);
    }

    
    /* Generate a random year for every county as an example */
    /*
    us_counties.features.forEach(function (item) {
        item.properties.time = Math.floor(Math.random() * (2014 - 2002 + 1)) + 2002;
    });
    */
    
    
    /*
    var map_us_counties = new L.geoJson(us_counties, {style: example_style, onEachFeature: onEachCounty}).addTo(map);   // add US counties
    
    var map_us_counties_1 = new L.geoJson(us_counties, {style: example_style, onEachFeature: onEachAdditionalCounty});
    */
    var i;
    var counties_per_year = {};
    var map_us_counties = new L.geoJson(us_counties, {style: blank_style, onEachFeature: onEachCounty}).addTo(map);
    /*var map_us_counties = new L.geoJson(us_counties, {style: blank_style, onEachFeature: onEachCounty}).addTo(map);*/
    for (i = 2002; i < 2015; i++) {
        counties_per_year[i] = new L.geoJson(us_counties, {style: example_style, onEachFeature: onEachAdditionalCounty}).addTo(map);
    }
    
    var map_us_states = new L.geoJson(us_states, {style: state_outline_style}).addTo(map);   // add US states
    
    var hash = new L.Hash(map); // Continually append the Center and Zoom to the base URL
    
    </script>
</body>
</html>